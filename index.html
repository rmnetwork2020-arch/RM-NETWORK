<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>RM-NETWORK ULTIMATE AUTO-SYSTEM</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body { font-family: sans-serif; padding: 10px; background: #0a0a0b; color: #e0e0e0; margin: 0; }
        .card { background: #16161d; padding: 25px; border-radius: 20px; max-width: 600px; margin: auto; border: 1px solid #2c2c3e; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .header { text-align: center; margin-bottom: 20px; }
        .header h2 { color: #28a745; margin: 0; font-size: 22px; }
        label { font-size: 11px; color: #aaa; text-transform: uppercase; font-weight: bold; display: block; margin-bottom: 5px; }
        input, select, button { width: 100%; padding: 12px; margin-bottom: 15px; border-radius: 10px; border: 1px solid #333; box-sizing: border-box; font-size: 14px; background: #1f1f2e; color: #fff; }
        .btn-main { background: linear-gradient(135deg, #28a745, #218838); color: white; font-weight: bold; border: none; cursor: pointer; height: 50px; }
        .btn-copy { background: #3d3d5c; color: white; border: none; padding: 8px; cursor: pointer; border-radius: 6px; font-size: 12px; margin-bottom: 10px; }
        textarea { width: 100%; height: 80px; font-size: 11px; border-radius: 8px; background: #000; color: #00ff41; border: 1px solid #333; resize: none; padding: 10px; box-sizing: border-box; font-family: monospace; }
        table { width: 100%; border-collapse: collapse; font-size: 11px; margin-top: 10px; background: #1e1e2d; }
        th, td { border: 1px solid #333; padding: 8px; text-align: left; }
        th { background: #28a745; color: white; }
        .history-sec { margin-top: 30px; border-top: 2px dashed #333; padding-top: 20px; }
        .btn-del { background: #ff4444; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="card">
        <div class="header">
            <h2>笞｡ RM-SYSTEM AUTO</h2>
            <p style="font-size:12px; color:#777;">System Management User CHR</p>
        </div>
        
        <label>TOKEN BOT TELEGRAM</label>
        <input type="text" id="token" oninput="saveConfig()" placeholder="Cukup input sekali...">

        <label>CHAT ID TELEGRAM</label>
        <input type="text" id="chatId" oninput="saveConfig()" placeholder="Cukup input sekali...">

        <hr style="border:0; border-top:1px solid #333; margin-bottom:15px;">

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
            <div><label>Nama User</label><input type="text" id="nama" placeholder="Contoh: imas"></div>
            <div><label>No Urut (IP)</label><input type="number" id="no" placeholder="Contoh: 10"></div>
        </div>

        <label>Layanan & WhatsApp</label>
        <div style="display:grid; grid-template-columns: 1fr 1.5fr; gap:10px;">
            <select id="tipe">
                <option value="vpn">VPN REMOTE</option>
                <option value="pppoe">PPPoE LOKAL</option>
            </select>
            <input type="text" id="wa" placeholder="628xxx">
        </div>

        <button class="btn-main" onclick="generateAll()">櫨 GENERATE & SIMPAN RIWAYAT</button>

        <div id="result" style="display:none;">
            <h4>SCRIPT SERVER (PASTE KE CHR)</h4>
            <textarea id="sServer"></textarea>
            <button class="btn-copy" onclick="copy('sServer')">SALIN SCRIPT SERVER</button>
            <hr>
        </div>

        <div class="history-sec">
            <h4>搭 RIWAYAT USER TERDAFTAR</h4>
            <table id="userTable">
                <thead>
                    <tr>
                        <th>User</th>
                        <th>IP</th>
                        <th>Tempo</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody id="historyBody"></tbody>
            </table>
            <button onclick="clearHistory()" style="background:none; border:none; color:#777; font-size:10px; margin-top:10px; cursor:pointer;">Hapus Semua Riwayat</button>
        </div>
    </div>

    <script>
        // Ambil data otomatis saat web dibuka
        window.onload = function() {
            document.getElementById('token').value = localStorage.getItem('rm_token') || '';
            document.getElementById('chatId').value = localStorage.getItem('rm_chatId') || '';
            renderHistory();
        };

        function saveConfig() {
            localStorage.setItem('rm_token', document.getElementById('token').value);
            localStorage.setItem('rm_chatId', document.getElementById('chatId').value);
        }

        function generateAll() {
            var tok = document.getElementById('token').value;
            var cid = document.getElementById('chatId').value;
            var n = document.getElementById('nama').value.replace(/\s+/g, '');
            var i = document.getElementById('no').value;
            var tpe = document.getElementById('tipe').value;
            var w = document.getElementById('wa').value;

            if(!n || !i || !tok || !cid) { alert("Data harus lengkap!"); return; }

            var s = "41.216.190.85"; 
            var c = "10.10.10." + i; 
            var pW = 8000 + parseInt(i); var pM = 9000 + parseInt(i); var pA = 7000 + parseInt(i);

            var t = new Date(); t.setDate(t.getDate() + 30);
            var tStr = t.toLocaleDateString('id-ID', { day:'numeric', month:'long' });
            var tMik = t.toLocaleDateString('en-US', { month:'short', day:'2-digit', year:'numeric' }).replace(/,/g, '');

            // Simpan ke Riwayat
            var history = JSON.parse(localStorage.getItem('rm_history') || '[]');
            history.push({ nama: n, ip: c, tempo: tStr });
            localStorage.setItem('rm_history', JSON.stringify(history));
            renderHistory();

            // Generate Script
            document.getElementById('sServer').value = "/ppp secret add name=\""+n+"\" password=\""+n+"123\" service=l2tp remote-address="+c+" local-address=10.10.10.1 comment=\""+tMik+"\"; /ip firewall nat add action=dst-nat chain=dstnat dst-address="+s+" dst-port="+pW+" protocol=tcp to-addresses="+c+" to-ports=8291 comment=\""+n+"-Winbox\";";
            document.getElementById('result').style.display = "block";
            alert("Berhasil! Riwayat tersimpan.");
        }

        function renderHistory() {
            var history = JSON.parse(localStorage.getItem('rm_history') || '[]');
            var body = document.getElementById('historyBody');
            body.innerHTML = "";
            history.forEach((item, index) => {
                body.innerHTML += `<tr>
                    <td>${item.nama}</td>
                    <td>${item.ip}</td>
                    <td>${item.tempo}</td>
                    <td><button class="btn-del" onclick="deleteUser(${index})">X</button></td>
                </tr>`;
            });
        }

        function deleteUser(index) {
            var history = JSON.parse(localStorage.getItem('rm_history') || '[]');
            history.splice(index, 1);
            localStorage.setItem('rm_history', JSON.stringify(history));
            renderHistory();
        }

        function clearHistory() {
            if(confirm("Hapus semua riwayat?")) {
                localStorage.removeItem('rm_history');
                renderHistory();
            }
        }

        function copy(id) {
            var t = document.getElementById(id); t.select();
            document.execCommand("copy"); alert("Script disalin!");
        }
    </script>
</body>
</html>
